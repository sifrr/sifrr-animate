{"version":3,"file":"sifrr.animate.module.js","sources":["../src/bezier.js","../src/types.js","../src/animateone.js","../src/animate.js","../index.js"],"sourcesContent":["const beziers = {};\n\nclass Bezier {\n  constructor(args){\n    const key = args.join('_');\n    if (!beziers[key]) {\n      this.setProps(...args);\n      beziers[key] = this.final.bind(this);\n    }\n    return beziers[key];\n  }\n\n  setProps(x1, y1, x2, y2) {\n    let props = {\n      x1: x1,\n      y1: y1,\n      x2: x2,\n      y2: y2,\n      A: (aA1, aA2) => 1.0 - 3.0 * aA2 + 3.0 * aA1,\n      B: (aA1, aA2) => 3.0 * aA2 - 6.0 * aA1,\n      C: (aA1) => 3.0 * aA1,\n      CalcBezier: (aT, aA1, aA2) => ((this.A(aA1, aA2)*aT + this.B(aA1, aA2))*aT + this.C(aA1))*aT,\n      GetSlope: (aT, aA1, aA2) => 3.0 * this.A(aA1, aA2)*aT*aT + 2.0 * this.B(aA1, aA2) * aT + this.C(aA1)\n    };\n    Object.assign(this, props);\n  }\n\n  final(x) {\n    if (this.x1 == this.y1 && this.x2 == this.y2) return x;\n    return this.CalcBezier(this.GetTForX(x), this.y1, this.y2);\n  }\n\n  GetTForX(xx) {\n    let t = xx;\n    for (let i = 0; i < 4; ++i) {\n      let slope = this.GetSlope(t, this.x1, this.x2);\n      if (slope == 0.0) return t;\n      let x = this.CalcBezier(t, this.x1, this.x2) - xx;\n      t -= x / slope;\n    }\n    return t;\n  }\n}\n\nmodule.exports = Bezier;\n","module.exports = {\n  linear: [0, 0, 1, 1],\n  ease: [.25, .1, .25, 1],\n  easeIn: [.42, 0, 1, 1],\n  easeOut: [0, 0, .58, 1],\n  easeInOut: [.42, 0, .58, 1]\n};\n","const Bezier = require('./bezier');\nconst types = require('./types');\nconst digitRgx = /(\\d+)/;\n\nfunction animateOne({\n  target,\n  prop,\n  from,\n  to,\n  time = 300,\n  type = 'ease',\n  onUpdate,\n  round = false\n} = {}) {\n  const toSplit = to.toString().split(digitRgx), l = toSplit.length, raw = [], fromNums = [], diffs = [];\n  const fromSplit = (from || target[prop] || '').toString().split(digitRgx);\n  const onUp = typeof onUpdate === 'function';\n  for (let i = 0; i < l; i++) {\n    const n = Number(toSplit[i]);\n    if (isNaN(n) || !toSplit[i]) raw.push(toSplit[i]);\n    else {\n      fromNums.push(Number(fromSplit[i]));\n      diffs.push(n - (Number(fromSplit[i]) || 0));\n    }\n  }\n  type = typeof type === 'function' ? type : new Bezier(types[type] || type);\n\n  return new Promise(res => {\n    let startTime;\n    function frame(currentTime) {\n      startTime = startTime || currentTime;\n      const percent = (currentTime - startTime) / time, bper = type(percent);\n      if (percent >= 1) {\n        target[prop] = to;\n        return res();\n      }\n      const next = diffs.map((d, i) => {\n        if (round) return Math.round(bper * d + (fromNums[i] || 0));\n        return bper * d + (fromNums[i] || 0);\n      });\n      const val = String.raw({ raw }, ...next);\n      target[prop] = Number(val) || val;\n      if (onUp) onUpdate(target, prop, val);\n      window.requestAnimationFrame(frame);\n    }\n    window.requestAnimationFrame(frame);\n  });\n}\n\nmodule.exports = animateOne;\n","const animateOne = require('./animateone');\n\nfunction animate({\n  targets,\n  target,\n  to,\n  time,\n  type,\n  onUpdate,\n  round\n} = {}) {\n  targets = targets ? Array.from(targets) : [target];\n  function iterate(target, props) {\n    const promises = [];\n    for (let prop in props) {\n      let from, final;\n      if (Array.isArray(props[prop])) [from, final] = props[prop];\n      else final = props[prop];\n      if (typeof props[prop] === 'object' && !Array.isArray(props[prop])) {\n        promises.push(iterate(target[prop], props[prop]));\n      } else {\n        promises.push(animateOne({\n          target,\n          prop,\n          to: final,\n          time,\n          type,\n          from,\n          onUpdate,\n          round\n        }));\n      }\n    }\n    return Promise.all(promises);\n  }\n  return Promise.all(targets.map(target => iterate(target, to)));\n}\n\nmodule.export = animate;","const animate = require('./src/animate');\nconst types = require('./src/types');\nanimate.types = types;\n\nmodule.exports = {\n  animate,\n  wait: function(time = 0) {\n    return new Promise(res => setTimeout(res, time));\n  }\n};\n"],"names":["Bezier","animateOne","animate"],"mappings":"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"}